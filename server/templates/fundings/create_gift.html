{% extends '../base.html' %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/fundings/create_gift.css' %}">
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
{% endblock head %}

{% block header %}
<div class="create-gift-title">
    <i onClick="history.go(-1)" class="icon-left fa-solid fa-chevron-left"></i>
    <p class="create-gift-title-for-center notosans-bold-24">선물하기</p>
</div>
{% endblock header %}

{%block content%}

<div class="img-container">
<img class="changing-present" src="{%static 'images/1.png'%}">
</div>
<form method = "POST" action="">
    {% csrf_token %}
<div class="create-gift-container">
    <div class="gift-first">
        <div>
        <p class="notosans-bold-18">선물 금액</p>
        <p class="notosans-regular-12 colorgray-create-html">* 0원부터 1,000,000원까지 선물할 수 있어요!</p>
        </div>
        <input id="funding_amount" class="funding_price_input notosans-bold-18" type="text" name="funding_price" value="0">
    </div>

    <div class="button-group transfer-btn-presents">
      <button class="notosans-bold-16 blue-btn-gift" type="button" data-value = "5000">5,000</button>
      <button class="notosans-bold-16 blue-btn-gift" type="button" data-value = "10000">10,000</button>
      <button class="notosans-bold-16 blue-btn-gift" type="button" data-value = "20000">20,000</button>
      <button class="notosans-bold-16 blue-btn-gift" type="button" data-value = "30000">30,000</button>
      <button class="notosans-bold-16 blue-btn-gift" type="button" data-value = "50000">50,000</button>
      <button class="notosans-bold-16 orange-btn-gift" type="button" data-value = "0">직접 입력</button>
    </div>

    <p class="notosans-bold-18">송금할 서비스</p>
    <div class="payment-link-btn-container">
        <div class="payment-btn-kakao div-btn transfer-btn" id="kakaoTransferLink">
            <a href="{{funding.user.kakao_account}}">
                <img src="{%static 'images/kakao-pay.png'%}">
            </a>
        </div>        
        {% if funding.user.toss_account %}
        <div class="payment-btn-toss div-btn transfer-btn" id="tossTransferLink">
            <a href="{{funding.user.toss_account}}">
                <img src="{%static 'images/toss-pay.png'%}">
            </a>
        </div>
        {%endif%}

    </div>

    <div class="input-group-create-gift">
        <div class="gift-second">
            <label class="notosans-bold-18" for="message">생일 축하 메시지</label><p class="notosans-regular-12 colorgray-create-html">*30자 ~ 500자</p>
        </div>
        <textarea id="birthday_message" class="input-bday-message" name="content"></textarea>
        <p class="notosans-regular- colorgray-create-html"> 전달 완료된 메시지는 나중에 수정할 수 없어요!<br>심한 비속어 및 상대를 비방하는 메시지는 전달되지 않을 수 있습니다. </p>
    </div>
    
    <div class="nickname-container">
        <p class="notosans-bold-18">친구에게 보여줄 닉네임</p>
        <input id="gift_nickname" class="notosans-bold-16 gift-nickname" type="text" name="comment_name" value="챙용">
    </div>
    <button class="give_present div-btn" type="submit">
        <p class="notosans-bold-16 ">선물 완료하기</p>
    </button>
</div>
</form>

  
{%endblock%}

{%block script%}
<script>
        
    document.addEventListener("DOMContentLoaded", function() {
        //버튼 누를시 input 벨류를 버튼 클릭시 금액으로 변경
        const priceButtons = document.querySelectorAll(".blue-btn-gift");

        //금액 직접 입력시
        priceButtons.forEach(function(button) {
            button.addEventListener("click", function() {
                let value = this.getAttribute("data-value");
                document.querySelector("input[name='funding_price']").value = value;
            });
        });
        
        //엔터 누를때 폼 기본 제출 방지
        //const form = document.querySelector("form"); 

       // form.addEventListener("submit", function(event) {
       // event.preventDefault(); 
       // });


        //송금링크에 금액 추가
        const transferButtons = document.querySelectorAll(".transfer-btn");

        const originalKakaoURL = document.getElementById("kakaoTransferLink").querySelector("a").href;
        const originalTossURL = document.getElementById("tossTransferLink").querySelector("a").href;

        transferButtons.forEach(function(button) {
            button.addEventListener("click", function() {
                let kakaoTransferLink = document.getElementById("kakaoTransferLink").querySelector("a");
                let tossTransferLink = document.getElementById("tossTransferLink").querySelector("a");

                let inputValue = document.querySelector("input[name='funding_price']").value;
                let multipliedValue = inputValue * 8;
                let hexadecimalValue = multipliedValue.toString(16);
                
                let kakaoInfo = [originalKakaoURL, hexadecimalValue, '0000'];
                kakaoTransferLink.href = kakaoInfo.join('');
                
                let tossInfo = [originalTossURL, inputValue.toString()];
                tossTransferLink.href = tossInfo.join('/');
            });
        });
    });



    //금액 버튼 누를때 뜨는 선물 이미지가 달라지게 
    const priceButtons = document.querySelectorAll(".blue-btn-gift");
    const presentImage = document.querySelector(".changing-present");

    priceButtons.forEach(function(button) {
        button.addEventListener("click", function() {
            let value = this.getAttribute("data-value");
            switch(value) {
                case "5000":
                    presentImage.src = "{% static 'images/2.png' %}";
                    break;
                case "10000":
                    presentImage.src = "{% static 'images/3.png' %}";
                    break;
                case "20000":
                    presentImage.src = "{% static 'images/4.png' %}";
                    break;
                case "30000":
                    presentImage.src = "{% static 'images/5.png' %}";
                    break;
                case "50000":
                    presentImage.src = "{% static 'images/6.png' %}";
                    break;
                case "0":
                    presentImage.src = "{% static 'images/7.png' %}";
                    break;
                default:
                    presentImage.src = "{% static 'images/1.png' %}";
            }
        });
    });
    
</script>
{%endblock script%}