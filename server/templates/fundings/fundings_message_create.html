{% extends "base.html" %}
{%block content%}
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<form method = "POST" action="">
        {% csrf_token %}
        <div class="present-price">선물금액 : {{form.funding_price}}</div>        
        <div class="image-wrapper">
            <div class="present-image"> 선물 이미지 칸</div>
            <div class="btn-wrapper">
                <div class="btn btn-price" data-value="5000">5,000</div>
                <div class="btn btn-price" data-value="10000">10,000</div>
                <div class="btn btn-price" data-value="20000">20,000</div>
                <div class="btn btn-price" data-value="30000">30,000</div>
                <div class="btn btn-price" data-value="50000">50,000</div>
                <div class="btn btn-price" data-value="0">직접 입력</div>
            </div>
        </div>
        <div class="transfer-title">송금하기  <span class="transfer-info">친구에게 선물할 계좌를 선택하세요</span></div>
        <div class="btn btn-transfer" id="tossTransferLink"><a href="{{funding.user.toss_account}}">토스 송금</a></div>
        <div class="btn btn-transfer" id="kakaoTransferLink"><a href="{{funding.user.kakao_account}}">카카오 송금</a></div>
        <div class="comment-user">친구에게 보여줄 닉네임 <span class="commnet-user-form">{{form.comment_name}}</span></div>
        <div class="message-wrapper">
            <div class="message-title">생일축하 메세지<span class="message-info"> *30자~500자</span></div>
            <p>{{form.content}}</p>
        </div>
        <div class="message-info">심한 비속어 및 상대를 비방하는 메세지는 전달되지 않을 수 있음을 알려드립니다.<br>작성된 메세지는 수정이 불가합니다.</div>
        <input type="submit" value="선물 완료하기">
    </form> 


    <script>
        
        document.addEventListener("DOMContentLoaded", function() {
            //버튼 누를시 input 벨류를 버튼 클릭시 금액으로 변경
            const priceButtons = document.querySelectorAll(".btn.btn-price");
    
            priceButtons.forEach(function(button) {
                button.addEventListener("click", function() {
                    let value = this.getAttribute("data-value");
                    document.querySelector("input[name='funding_price']").value = value;
                });
            });

            //송금링크에 금액 추가
            const transferButtons = document.querySelectorAll(".btn.btn-transfer");

            const originalKakaoURL = document.getElementById("kakaoTransferLink").querySelector("a").href;
            const originalTossURL = document.getElementById("tossTransferLink").querySelector("a").href;

            transferButtons.forEach(function(button) {
                button.addEventListener("click", function() {
                    let kakaoTransferLink = document.getElementById("kakaoTransferLink").querySelector("a");
                    let tossTransferLink = document.getElementById("tossTransferLink").querySelector("a");

                    let inputValue = document.querySelector("input[name='funding_price']").value;
                    let multipliedValue = inputValue * 8;
                    let hexadecimalValue = multipliedValue.toString(16);
                    
                    let kakaoInfo = [originalKakaoURL, hexadecimalValue, '0000'];
                    kakaoTransferLink.href = kakaoInfo.join('');
                    
                    let tossInfo = [originalTossURL, inputValue.toString()];
                    tossTransferLink.href = tossInfo.join('/');
                });
            });
        });
        
    </script>
{%endblock%}